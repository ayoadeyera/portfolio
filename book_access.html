<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnetic Writing: Exclusive Content Access</title>
    
    <!-- --- STYLING & ICONS --- -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], },
                    colors: { midnight: '#030712', surface: '#111827', pink: '#f472b6', cyan: '#06b6d4', },
                }
            }
        }
    </script>

    <!-- --- FIREBASE LOGIC --- -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase Log Level (Optional: for debugging)
        // setLogLevel('Debug'); // Uncomment this if you need deep debug logs

        const BOOK_TITLE_SLUG = 'MagneticWriting';
        
        // --- Firebase Configuration ---
        const firebaseConfig = {
             apiKey: "AIzaSyBcSfjJDN_8RexWeaTvEh_QZ0UAzRsh3V0", 
             authDomain: "portfolio-a00c5.firebaseapp.com",
             projectId: "portfolio-a00c5",
             storageBucket: "portfolio-a00c5.firebasestorage.app",
             messagingSenderId: "799536032064",
             appId: "1:799536032064:web:7bbd6be03855223bb2f2a5",
             measurementId: "G-G85HXV3BKQ"
        };
        // ------------------------------

        // Use the projectId as the unique identifier for the firestore pathing
        const appId = firebaseConfig.projectId; 
        
        let app, db, auth, userId;
        let isAuthReady = false;

        // UI elements
        const statusDiv = document.getElementById('access-status');
        const contentDiv = document.getElementById('book-content');
        const accessForm = document.getElementById('access-form');

        // Function to update the UI message
        const updateStatus = (html, color = 'cyan') => {
            statusDiv.innerHTML = `<div class="text-${color}-400 flex items-center justify-center">${html}</div>`;
        };

        // Core Function: Check if the user has accessed the content before
        const checkAccessStatus = async (currentUserId) => {
            // Firestore pathing structure MUST be /artifacts/{appId}/users/{userId}/...
            const accessPath = `/artifacts/${appId}/users/${currentUserId}/bookAccess/${BOOK_TITLE_SLUG}`;
            const accessDocRef = doc(db, accessPath);
            
            try {
                const docSnap = await getDoc(accessDocRef);

                if (docSnap.exists() && docSnap.data().hasAccessed) {
                    // 1. ACCESS DENIED (Already accessed)
                    console.log("Access already used.");
                    updateStatus(`
                        <div class="p-8 bg-red-900/50 rounded-xl text-center shadow-lg border border-red-700">
                            <i class="fas fa-times-circle text-6xl text-red-500 mb-4"></i>
                            <h2 class="text-3xl font-bold text-white mb-2">Access Expired.</h2>
                            <p class="text-lg text-red-300">
                                You have already viewed the exclusive content. Access is limited to a single view per account.
                            </p>
                            <p class="text-sm text-red-400 mt-4">
                                Your User ID: <span class="font-mono text-red-200 break-all">${currentUserId}</span>
                            </p>
                        </div>
                    `, 'red');
                    accessForm.classList.add('hidden');
                    contentDiv.classList.add('hidden');

                } else {
                    // 2. ACCESS PENDING (Show Form)
                    console.log("First time visit. Showing form.");
                    updateStatus(`
                        <p class="text-lg text-gray-400 mb-6">
                            Fill out the form below to grant your single-use access to the exclusive book content.
                        </p>
                    `, 'gray');
                    accessForm.classList.remove('hidden');
                    contentDiv.classList.add('hidden');
                }
            } catch (e) {
                console.error("Firestore access check failed:", e);
                updateStatus(`
                    <div class="p-4 bg-red-900/50 rounded-xl shadow-lg border border-red-700">
                        <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>
                        Database Access Error: 
                        <span class="font-bold">Failed to connect to Firestore.</span>
                        <p class="text-sm mt-2 text-red-300">
                            Error details: ${e.message}
                        </p>
                    </div>
                `, 'red');
            }
        };

        // Function: Handle form submission and grant access
        const grantAccess = async (name, email) => {
            if (!userId) {
                console.error("User ID not available. Authentication failed.");
                updateStatus('<p>Authentication failed. Please try refreshing.</p>', 'red');
                return;
            }

            const accessPath = `/artifacts/${appId}/users/${userId}/bookAccess/${BOOK_TITLE_SLUG}`;
            const accessDocRef = doc(db, accessPath);
            
            try {
                // 1. Immediately flag access as used in Firestore, storing user details
                await setDoc(accessDocRef, { 
                    hasAccessed: true, 
                    accessTime: new Date().toISOString(),
                    name: name,
                    email: email,
                });
                
                // 2. Hide form, clear status, and show content
                updateStatus('', 'cyan');
                accessForm.classList.add('hidden');
                contentDiv.classList.remove('hidden');

                console.log("Access granted and flagged as used.");
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (e) {
                console.error("Firestore access grant failed:", e);
                updateStatus(`<p>Failed to grant access. A database write error occurred: ${e.message}</p>`, 'red');
            }
        };


        // Setup event listener for the form
        if (accessForm) {
            accessForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('user-name').value;
                const email = document.getElementById('user-email').value;
                
                if (name && email) {
                    grantAccess(name, email);
                } else {
                    updateStatus('<p>Please provide your name and email address to continue.</p>', 'red');
                }
            });
        }


        // Authentication setup using Anonymous Sign-in 
        const handleSignIn = async () => {
            try {
                const userCredential = await signInAnonymously(auth); 
                console.log("Signed in anonymously:", userCredential.user.uid);
            } catch (error) {
                console.error("Anonymous Authentication Error:", error);
                updateStatus(`
                    <div class="p-4 bg-red-900/50 rounded-xl shadow-lg border border-red-700">
                        <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>
                        Authentication Error: 
                        <span class="font-bold">Anonymous Sign-in is NOT enabled.</span>
                        <p class="text-sm mt-2 text-red-300">
                            Please go to your Firebase Console and enable the <span class="font-bold text-white">Anonymous</span> provider.
                        </p>
                    </div>
                `, 'red');
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            
            // Initialization checks
            if (!firebaseConfig || !firebaseConfig.apiKey || !firebaseConfig.projectId) {
                updateStatus('<p>Error: Firebase configuration is missing or invalid. Check your pasted configuration details.</p>', 'red');
                return;
            }

            // Initialize Firebase
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Wait for auth state to resolve before running logic
            onAuthStateChanged(auth, async (user) => {
                isAuthReady = true;
                if (user) {
                    userId = user.uid;
                    updateStatus('<i class="fas fa-search mr-3 fa-spin"></i> Checking access status...', 'cyan');
                    // We must wait for this check, otherwise the UI flickers
                    await checkAccessStatus(userId);
                } else {
                    // If no user is logged in (first load), initiate sign-in
                    await handleSignIn();
                }
            });
        });
    </script>

</head>
<body class="bg-midnight text-gray-300 antialiased min-h-screen flex flex-col justify-center items-center py-12">

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold text-white mb-2">
                <span class="text-pink-400">MAGNETIC WRITING</span>
            </h1>
            <p class="text-xl text-gray-400">Exclusive Full Book Content Access</p>
        </header>

        <!-- Dynamic Status/Denied Message Area -->
        <div id="access-status" class="text-center mb-8">
             <div class="text-cyan-400 flex items-center justify-center"><i class="fas fa-spinner fa-spin mr-3"></i> Loading authentication...</div>
        </div>

        <!-- Access Form (Shown only if access is pending) -->
        <form id="access-form" class="hidden max-w-lg mx-auto p-8 bg-surface rounded-xl shadow-2xl border border-gray-800 space-y-6">
            <h2 class="text-2xl font-bold text-white mb-4 text-center">Get Your Single-Use Pass</h2>

            <div>
                <label for="user-name" class="block text-sm font-medium text-gray-300 mb-1">Your Full Name</label>
                <input type="text" id="user-name" required class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500 text-white placeholder-gray-400">
            </div>

            <div>
                <label for="user-email" class="block text-sm font-medium text-gray-300 mb-1">Email Address</label>
                <input type="email" id="user-email" required class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500 text-white placeholder-gray-400">
            </div>

            <button type="submit" class="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-midnight bg-pink-400 hover:bg-pink-300 shadow-lg shadow-pink-500/30 transition-all">
                Grant Single-Use Access <i class="fas fa-unlock ml-2"></i>
            </button>
            <p class="text-xs text-center text-gray-500 mt-4">
                We respect your privacy. Your details are used solely for access control and follow-up.
            </p>
        </form>

        <!-- Book Content Area (Hidden until access is granted) -->
        <section id="book-content" class="hidden mt-10">
            <div class="p-8 md:p-10 bg-surface rounded-xl shadow-2xl border border-pink-700/50">
                <h2 class="text-3xl font-extrabold text-pink-400 mb-6 border-b border-gray-700 pb-3">
                    Magnetic Writing: The 12 Pillars of Influence
                </h2>
                <p class="text-gray-400 mb-8 italic">
                    <i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i> **Full Access Granted.** This entire section contains the core content. As a reminder, this access is limited to a single view per account.
                </p>

                <div class="space-y-10 text-lg text-gray-300">
                    <p>
                        Welcome to the foundational blueprint of **Magnetic Writing**. The concepts below are the 12 non-negotiable pillars that transform ordinary text into an Engine of Human Motivation, ensuring your words reliably convert readers into loyal clients and customers. Master these, and you master influence.
                    </p>

                    <!-- Pillar 1: The Anatomy of Good Writing -->
                    <div class="pt-4">
                        <h3 class="text-2xl font-bold text-white mb-2 border-b border-gray-800 pb-2">1. The Anatomy of Good Writing</h3>
                        <p class="text-base text-cyan-400 italic mb-4">
                            Focus: Structure, Flow, and Mechanical Precision.
                        </p>
                        <p>
                            Good writing isn't about flair; it's about architecture. This pillar is the foundation, ensuring your copy is reliable, profitable, and error-free. Every sentence must pass the **Purpose Test**: Does this sentence move the reader closer to the desired outcome? If not, it is disposable.
                        </p>
                        <ul class="list-disc list-inside ml-4 mt-3 space-y-1 text-gray-400 text-base">
                            <li>**The Rule of One:** Each paragraph holds only one core idea.</li>
                            <li>**Active Voice:** Use the language of authority and action for direct impact.</li>
                            <li>**Seamless Flow:** Use transitional phrases to guide the reader effortlessly down the page.</li>
                        </ul>
                    </div>

                    <!-- Pillar 2: The Influence Imperative -->
                    <div class="pt-4">
                        <h3 class="text-2xl font-bold text-white mb-2 border-b border-gray-800 pb-2">2. The Influence Imperative</h3>
                        <p class="text-base text-cyan-400 italic mb-4">
                            Focus: Selling Identity, Not Features.
                        </p>
                        <p>
                            People do not buy products; they buy **a better version of themselves**. The Influence Imperative demands you stop selling *what is* and start selling *what could be*. Your product is simply the vehicle for the reader's personal transformation.
                        </p>
                        <div class="p-4 bg-yellow-900/20 rounded-lg border border-yellow-700/50 my-4 text-base">
                            <p class="font-bold text-yellow-300">The Gap Principle:</p>
                            <p class="text-yellow-200">Motivate action by vividly illuminating the gap between the reader's **Current Reality** (painful) and their **Desired Reality** (aspirational), positioning your offer as the inevitable bridge.</p>
                        </div>
                    </div>

                    <!-- Pillar 3: Stimulating Human Potential -->
                    <div class="pt-4">
                        <h3 class="text-2xl font-bold text-white mb-2 border-b border-gray-800 pb-2">3. Stimulating Human Potential</h3>
                        <p class="text-base text-cyan-400 italic mb-4">
                            Focus: Tapping into Dormant Ambition and Desire.
                        </p>
                        <p>
                            This advanced psychological technique involves tapping into the reader's deepest, most ambitious dormant desires and motivations. Magnetic writing acts as a powerful catalyst, moving readers past procrastination and fear, and inspiring them toward life-changing decisions that align with your offer.
                        </p>
                        <p>
                            The goal is to frame the purchase as a moral imperative—a necessary step for them to reach their true, untapped potential. Your words don't just ask them to click; they compel them to *start living bigger*.
                        </p>
                    </div>

                    <!-- Pillar 4: Defying Talent: The Rear Method -->
                    <div class="pt-4">
                        <h3 class="text-2xl font-bold text-white mb-2 border-b border-gray-800 pb-2">4. Defying Talent: The Rear Method</h3>
                        <p class="text-base text-cyan-400 italic mb-4">
                            Focus: The Non-Talent-Based Blueprint for Conversion Copy.
                        </p>
                        <p>
                            Solomon Adeyera’s revolutionary system proves that innate talent is vastly overrated in the world of conversion copy. The "Rear Method" is a specific, repeatable blueprint designed to guarantee high-quality, magnetic copy for *anyone*, regardless of their perceived starting "writing gift."
                        </p>
                        <p>
                            This is a systematic approach to research, outline, draft, and edit that focuses on **process consistency** over creative spontaneity. It’s a method you can execute, not a talent you must be born with. **The secret is in the system, not the writer.**
                        </p>
                    </div>
                    
                    <div class="mt-12 pt-6 border-t border-gray-700 text-center">
                        <p class="text-white font-semibold">Thank you for viewing Magnetic Writing.</p>
                        <p class="text-sm text-gray-500 mt-1">Your single-use access for this session is now complete.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>